å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°å°èœä¸ªäºº **solo** å­¦å ‚ã€‚åœ¨è¿™é‡Œï¼ŒçŸ¥è¯†å…è´¹ï¼Œä¸åå¸æ”¶ï¼å…³æ³¨å…è´¹ï¼Œä¸ååŠ¨æ‰‹ï¼
**æ­»é¬¼~çœ‹å®Œè®°å¾—ç»™æˆ‘æ¥ä¸ªä¸‰è¿å“¦ï¼**


![](https://gitee.com/cbuc/picture/raw/master/17169c46045528af)


>æœ¬æ–‡ä¸»è¦ä»‹ç» `kubernetesé›†ç¾¤çš„æ­å»º`
>
>å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥å‚è€ƒ
>
>å¦‚æœ‰å¸®åŠ©ï¼Œä¸å¿˜ **ç‚¹èµ** â¥
>
>
>å¾®ä¿¡å…¬ä¼—å·å·²å¼€å¯ï¼Œ**å°èœè‰¯è®°**ï¼Œæ²¡å…³æ³¨çš„åŒå­¦ä»¬è®°å¾—å…³æ³¨å“¦ï¼

é˜…è¯»è¿™ç¯‡æ–‡ç« å…ˆéœ€è¦å¯¹ **docker** çš„åŸºæœ¬çŸ¥è¯†æœ‰æ‰€äº†è§£ï¼ç›¸å…³é˜…è¯»è¯·ç§»æ­¥ï¼š[Dockerä¸Šæ‰‹ï¼Œçœ‹å®Œè§‰å¾—è‡ªå·±åˆè¡Œäº†ï¼](https://mp.weixin.qq.com/s/BViQO6ZBZJ0VTsgi3HZeSw)

ç›¸ä¿¡ç‚¹è¿›æ¥çš„å°ä¼™ä¼´åº”è¯¥éƒ½å¯¹ **k8s** æœ‰æ‰€è€³é—»ï¼Œç”šè‡³äºå·²ç»ä½¿ç”¨ä¸Šäº†ã€‚è€Œå¦‚æœæ˜¯å› ä¸ºå¯¹æ ‡é¢˜æ„Ÿåˆ°å¥½å¥‡çš„å°ä¼™ä¼´ä¹Ÿåˆ«æ€¥ç€åˆ’èµ°ï¼Œå› ä¸ºæˆ‘åŠä½ ä¸€å®šè¦å­¦ä¹  **Kubernetesï¼ˆk8sï¼‰**ã€‚è€Œæ ‡é¢˜ä¹Ÿå¹¶éæ ‡é¢˜å…šï¼Œç”±äº **k8s** é›†ç¾¤å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- **ä¸€ä¸»å¤šä»**ï¼šä¸€å° master èŠ‚ç‚¹å’Œå¤šå° node èŠ‚ç‚¹ï¼Œæ­å»ºæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ‰å¯èƒ½å‡ºç° master å•æœºæ•…éšœ
- **å¤šä¸»å¤šä»ï¼š** å¤šå° master èŠ‚ç‚¹å’Œå¤šå° node èŠ‚ç‚¹ï¼Œæ­å»ºæ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯å®‰å…¨æ€§é«˜

ä¸ç®¡æ˜¯ **ä¸€ä¸»å¤šä»** å¼‚æˆ–è€…æ˜¯ **å¤šä¸»å¤šä»** ï¼Œè¿™é‡Œè‡³å°‘éƒ½æ˜¯éœ€è¦ä¸‰å°æœåŠ¡å™¨ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„è§„æ ¼è‡³å°‘å¾—åœ¨ `2Gå†…å­˜ 2é¢—CPU` é…ç½®èµ·æ­¥ï¼Œè€Œæˆ‘ä»¬å¦‚æœçº¯å±ä¸ºäº†å¹³æ—¶ç»ƒä¹ ä½¿ç”¨ï¼ŒèŠ±è´¹ä¸€ç¬”é’±å»æŠ•èµ„æœåŠ¡å™¨ï¼Œå¯èƒ½æœ‰éƒ¨åˆ†äººæ˜¯ä¸æ„¿æ„çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±å‘¼åº”äº†æ ‡é¢˜~æ¥ä¸‹æ¥å°èœå°†å¸¦ç»™ä½ æ¯”è¾ƒèŠ‚çœçš„æ–¹æ¡ˆå»å­¦ä¹  **k8sé›†ç¾¤çš„æ­å»º**ï¼

å¼€å¤´è¯´åˆ°ï¼Œ**æˆ‘åŠä½ ä¸€å®šè¦å­¦ä¹  k8s** è¿™å¹¶éæ˜¯ä¸€å¥ç©ºè¯ã€‚å½“ä¸‹ï¼Œäº‘åŸç”Ÿä¹Ÿå¹¶éæ˜¯ä¸€ä¸ªæ–°åè¯ï¼Œå®ƒå·²ç»æŒ‡å®šäº†ä¸€æ¡æ–°çš„å¼€å‘é“è·¯ï¼Œ**æ•æ·ã€å¯æ‰©å±•ã€å¯å¤åˆ¶ã€æœ€å¤§åŒ–åˆ©ç”¨...**ä¾¿æ˜¯è¿™æ¡é“è·¯çš„ä»£åè¯ï¼è¿™ç¯‡æ–‡ç« ä¸å•å•ä»‹ç» **Kubernetes** çš„æ­å»ºï¼Œå¦‚æœå¯¹ **Kubernetes** æœ‰æ‰€ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç›´æ¥è·³è½¬åˆ° **Kubernetes é›†ç¾¤æ­å»º** çš„éƒ¨åˆ†ï¼Œå¦‚æœä¸ç†Ÿæ‚‰çš„åŒå­¦å»ºè®®å…ˆçœ‹çœ‹å‰åŠéƒ¨åˆ†ï¼Œå…ˆå¯¹ **Kubernetes** æœ‰æ‰€äº†è§£ä¸€ä¸‹ã€‚

## Kubernetes

#### ä¸€ã€K8s äº‹å‰äº†è§£

æœ‰äº›åŒå­¦å¯èƒ½æ„Ÿåˆ°æœ‰ç‚¹å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¸€ä¼šè¯´ **kubernetes**ï¼Œä¸€ä¼šè¯´ **k8s**ï¼Œè¿™ä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªä¸œè¥¿å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„

> Kubernetes ç®€ç§° k8sï¼Œæ˜¯ç”¨ 8 æ¥ä»£æ›¿ 8 ä¸ªå­—ç¬¦ **â€œuberneteâ€**  çš„ç¼©å†™

è¿™ä¸ªä¸€ä¸ªç”¨æ¥ç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–åº”ç”¨ï¼Œå®ƒçš„ç›®çš„ä¾¿æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•ä¸”é«˜æ•ˆï¼Œå®ƒæä¾›äº†åº”ç”¨éƒ¨ç½²ï¼Œè§„åˆ’ï¼Œæ›´æ–°ï¼Œç»´æŠ¤çš„ä¸€ç§æœºåˆ¶ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹éƒ¨ç½²åº”ç”¨çš„è¿­ä»£è¿‡ç¨‹ï¼š

- **ä¼ ç»Ÿéƒ¨ç½²ï¼š** ç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š

- **è™šæ‹ŸåŒ–éƒ¨ç½²ï¼š** å¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ
- **å®¹å™¨åŒ–éƒ¨ç½²ï¼š** ä¸è™šæ‹Ÿæœºç±»ä¼¼ï¼Œ ä½†æ˜¯å…±äº«äº†æ“ä½œç³»ç»Ÿ

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410180502.png)

çœ‹äº†ä»¥ä¸Šéƒ¨ç½²æ–¹å¼ï¼Œæƒ³æƒ³çœ‹ä½ ä»¬å…¬å¸ç°åœ¨æ˜¯ç”¨çš„å“ªä¸€ç§~è¯´åˆ°å®¹å™¨åŒ–éƒ¨ç½²ï¼Œå­¦è¿‡dockerçš„åŒå­¦è‚¯å®šç¬¬ä¸€æ—¶é—´æƒ³åˆ°**docker** ï¼Œ**docker** çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼ç¡®å®ç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©ï¼Œä½†æ˜¯é—®é¢˜ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œæœ‰æ—¶å€™è¿™äº›é—®é¢˜ä¼šè¢«æˆ‘ä»¬åˆ»æ„æ€§çš„å›é¿ï¼Œå› ä¸º **docker** å®åœ¨æ˜¯æœ‰ç‚¹å¥½ç”¨ï¼Œè®©äººæœ‰ç‚¹ä¸å¿å¿ƒå¯¹å®ƒäº§ç”Ÿè´¨ç–‘ï¼Œä½†æ˜¯åˆä¸å¾—ä¸é¢å¯¹ï¼š

- ä¸€ä¸ªå®¹å™¨æ•…éšœåœæœºäº†ï¼Œæ€ä¹ˆæ ·ä¿è¯é«˜å¯ç”¨è®©å¦å¤–ä¸€ä¸ªå®¹å™¨ç«‹åˆ»å¯åŠ¨å»æ›¿è¡¥ä¸Šåœæœºçš„å®¹å™¨

- å½“å¹¶å‘è®¿é—®é‡ä¸Šæ¥çš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥åšåˆ°è‡ªåŠ¨æ‰©å®¹ï¼Œå¹¶å‘è®¿é—®é‡ä¸‹å»çš„æ—¶å€™æ˜¯å¦å¯ä»¥åšåˆ°è‡ªåŠ¨ç¼©å®¹
- ...

å®¹å™¨çš„é—®é¢˜ç¡®å®æœ‰æ—¶å€™æŒºå€¼å¾—æ·±æ€çš„ï¼Œè€Œè¿™äº›å®¹å™¨ç®¡ç†çš„é—®é¢˜ç»Ÿç§°ä¸º **å®¹å™¨ç¼–æ’** é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ°çš„é—®é¢˜ï¼Œè‡ªç„¶æœ‰äººå»è§£å†³ï¼Œä¾‹å¦‚ **docker** è‡ªå®¶å°±æ¨å‡ºäº† **Docker Swarm** å®¹å™¨ç¼–æ’å·¥å…·ï¼Œ**Apache** é€€å‡ºäº† **Mesos** èµ„æºç»Ÿä¸€ç®¡æ§å·¥å…·ï¼Œ**Google** æ¨å‡ºäº†`Kubernetes`å®¹å™¨ç¼–æ’å·¥å…·ï¼Œè€Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¦è¯´åˆ°çš„ä¸»è§’ï¼

##### 1ï¼‰K8sä¼˜ç‚¹

- **è‡ªæˆ‘ä¿®å¤**ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨1ç§’å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨
- **å¼¹æ€§ä¼¸ç¼©**ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´
- **æœåŠ¡å‘ç°**ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡å¯åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡
- **ç‰ˆæœ¬å›é€€**ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬
- **å­˜å‚¨ç¼–æ’**ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·

##### 2ï¼‰K8s æ„æˆç»„ä»¶

ä¸€ä¸ªå®Œæ•´çš„ **Kubernetes** é›†ç¾¤æ˜¯ç”± **æ§åˆ¶èŠ‚ç‚¹ master** ã€**å·¥ä½œèŠ‚ç‚¹ node** æ„æˆçš„ï¼Œå› æ­¤è¿™ç§é›†ç¾¤æ–¹å¼ä¹Ÿåˆ†ä¸º **ä¸€ä¸»å¤šä»** å’Œ **å¤šä¸»å¤šä»**ï¼Œè€Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆä¼šå®‰è£…ä¸åŒç»„ä»¶ä»¥æä¾›æœåŠ¡ã€‚

###### 1ã€**Master**

é›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­–ï¼ˆç®¡ç†ï¼‰ã€‚å®ƒæ——ä¸‹å­˜åœ¨ä»¥ä¸‹ç»„ä»¶

- **ApiServer** ï¼šèµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€Api æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶
- **Scheduler**ï¼šè´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† **pod** è°ƒåº¦åˆ°ç›¸åº”çš„ **node** èŠ‚ç‚¹ä¸Š
- **ControllerManager**ï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ï¼Œæ•…éšœæ£€æµ‹ï¼Œè‡ªåŠ¨æ‰©å±•ï¼Œæ»šåŠ¨æ›´æ–°ç­‰
- **Etcd**ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯

###### 2ã€Node

é›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒï¼ˆå¹²æ´»ï¼‰ã€‚å®ƒæ——ä¸‹å­˜åœ¨ä»¥ä¸‹ç»„ä»¶

- **Kubelet**ï¼šè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶ docker æ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨
- **KubeProxy**ï¼šè´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410180554.png)

çœ‹å®Œäº†ä»¥ä¸Šä»‹ç»ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±å¼€å§‹è¿›è¡Œ **k8s** é›†ç¾¤çš„æ­å»ºï¼

#### äºŒã€k8s é›†ç¾¤æ­å»º

##### 1ï¼‰Centos7 å®‰è£…

é¦–å…ˆæˆ‘ä»¬éœ€è¦è½¯ä»¶ï¼š

- VMware Workstation Pro 
- Centos 7.0 é•œåƒ

è™šæ‹Ÿæœºè½¯ä»¶å¯ç™¾åº¦æŸ¥æ‰¾ä¸‹è½½ï¼Œå¦‚è‹¥æ²¡æœ‰è”ç³»å°èœï¼Œå°èœç»™ä½ æä¾›

é•œåƒå¯è®¿é—®é˜¿é‡Œäº‘è¿›è¡Œä¸‹è½½ï¼Œå¦‚ä¸‹å›¾ï¼š[ä¸‹è½½åœ°å€](http://mirrors.aliyun.com/centos/7/isos/x86_64/)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410191612.png)

å®Œæˆè™šæ‹Ÿæœºçš„å®‰è£…åæˆ‘ä»¬ä¾¿å¯åœ¨ **VMware** ä¸­å®‰è£… **Centos7**

- æˆ‘ä»¬é€‰æ‹© **åˆ›å»ºæ–°çš„è™šæ‹Ÿæœº**

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410192057.png)

- é€‰æ‹©è‡ªå®šä¹‰å®‰è£…

> å…¸å‹å®‰è£…ï¼šVMwareä¼šå°†ä¸»æµçš„é…ç½®åº”ç”¨åœ¨è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œå¯¹äºæ–°æ‰‹æ¥å¾ˆå‹å¥½ã€‚
>
> è‡ªå®šä¹‰å®‰è£…ï¼šè‡ªå®šä¹‰å®‰è£…å¯ä»¥é’ˆå¯¹æ€§çš„æŠŠä¸€äº›èµ„æºåŠ å¼ºï¼ŒæŠŠä¸éœ€è¦çš„èµ„æºç§»é™¤ã€‚é¿å…èµ„æºçš„æµªè´¹ã€‚

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225042.png)

- å…¼å®¹æ€§ä¸€èˆ¬å‘ä¸‹å…¼å®¹

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

- é€‰æ‹©æˆ‘ä»¬ä¸‹è½½å¥½çš„ **centos** é•œåƒ

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

- ç»™è‡ªå·±çš„è™šæ‹Ÿæœºåˆ†é…åç§°å’Œå®‰è£…åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸‰å°ï¼Œæ‰€ä»¥åç§°æˆ‘è¿™é‡Œåˆ†åˆ«å‘½åä¸ºï¼ˆmasterã€node01ã€node02ï¼‰

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

- ç»™è‡ªå·±çš„è™šæ‹Ÿæœºåˆ†é…èµ„æºï¼Œæœ€ä½è¦æ±‚ä¸€èˆ¬æ˜¯ 2æ ¸2Gå†…å­˜

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

- è¿™é‡Œä½¿ç”¨ **NAT** ç½‘ç»œç±»å‹

> æ¡¥æ¥ï¼šé€‰æ‹©æ¡¥æ¥æ¨¡å¼çš„è¯è™šæ‹Ÿæœºå’Œå®¿ä¸»æœºåœ¨ç½‘ç»œä¸Šå°±æ˜¯å¹³çº§çš„å…³ç³»ï¼Œç›¸å½“äºè¿æ¥åœ¨åŒä¸€äº¤æ¢æœºä¸Šã€‚
>
> NATï¼šNATæ¨¡å¼å°±æ˜¯è™šæ‹Ÿæœºè¦è”ç½‘å¾—å…ˆé€šè¿‡å®¿ä¸»æœºæ‰èƒ½å’Œå¤–é¢è¿›è¡Œé€šä¿¡ã€‚
>
> ä»…ä¸»æœºï¼šè™šæ‹Ÿæœºä¸å®¿ä¸»æœºç›´æ¥è¿èµ·æ¥

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410231559.png)

- æ¥ä¸‹æ¥ä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œç„¶åç‚¹å‡»å®Œæˆå³å¯

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225209.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225217.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225227.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225239.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406225255.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410195538.png)

- å®‰è£…å®Œåæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨é¡µé¢çœ‹åˆ°ä»¥ä¸‹ç»“æœï¼Œç‚¹å‡»å¼€å¯æ­¤è™šæ‹Ÿæœºï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410195907.png)

- é€‰æ‹© **install CentOS7**

![image-20210410200006452](https://gitee.com/cbuc/picture/raw/master/typora/20210410200006.png)

- ç„¶åå°±å¯ä»¥çœ‹åˆ°å®‰è£…è¿‡ç¨‹ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410200037.png)

- è¿‡ä¸€ä¼šä¾¿ä¼šçœ‹åˆ°è®©æˆ‘ä»¬é€‰æ‹©è¯­è¨€çš„ç•Œé¢ï¼Œè¿™é‡Œé€‰æ‹©ä¸­æ–‡å¹¶ç»§ç»­

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410200137.png)

- è½¯ä»¶é€‰æ‹©æˆ‘ä»¬å¯ä»¥é€‰`åŸºç¡€è®¾æ–½æœåŠ¡å™¨`ï¼Œå®‰è£…ä½ç½®å¯é€‰ `è‡ªåŠ¨åˆ†åŒº`

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410200250.png)

- ç„¶åæˆ‘ä»¬éœ€è¦ç‚¹å‡» **ç½‘ç»œå’Œä¸»æœºå** è¿›å…¥ç½‘ç»œé…ç½®

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406224402.png)

- æˆ‘ä»¬åœ¨ tarbar æ ç‚¹å‡» ç¼–è¾‘ -> è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ æŸ¥çœ‹è™šæ‹Ÿæœºçš„å­ç½‘IP

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410200507.png)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410200502.png)

- è¿™è¾¹æˆ‘ä»¬æ‰‹åŠ¨è‡ªå®šä¹‰æ·»åŠ  Ipv4 çš„åœ°å€ï¼ŒDNSæœåŠ¡å™¨å¯å¡«é˜¿é‡Œäº‘çš„

æˆ‘ä»¬åˆ†é…çš„åœ°å€éœ€è¦æ’é™¤ `255` å’Œ `02` è¿™ä¸¤ä¸ªåœ°å€ï¼Œåˆ†åˆ«æ˜¯å¹¿æ’­å’Œç½‘å…³åœ°å€ã€‚

æˆ‘æ˜¯è¿™æ ·é…ç½®çš„ï¼š

> **master èŠ‚ç‚¹** ï¼š `192.168.108.100`
>
> **node01 èŠ‚ç‚¹** ï¼š`192.168.108.101`
>
> **node02 èŠ‚ç‚¹** ï¼š`192.168.108.102`

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406224700.png)

- é…ç½®å®Œé€‰æ‹©ä¿å­˜å¹¶ç‚¹å‡»å®Œæˆï¼Œç„¶åè®¾ç½®ä¸»æœºå

æˆ‘æ˜¯è¿™æ ·é…ç½®çš„ï¼š

> **master èŠ‚ç‚¹** ï¼š `master`
>
> **node01 èŠ‚ç‚¹** ï¼š`node01`
>
> **node02 èŠ‚ç‚¹** ï¼š`node02`

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406224745.png)

- å®Œæˆä»¥ä¸Šé…ç½®åï¼Œå¤§è‡´æ˜¯å¦‚ä¸‹æ ·å­

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406224857.png)

- ç‚¹å‡»å¼€å§‹å®‰è£…åï¼Œæˆ‘ä»¬æ¥åˆ°äº†ä»¥ä¸‹é¡µé¢ï¼Œç„¶åé…ç½®ä»¥ä¸‹ä¸¤ä¸ªä¿¡æ¯

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406224917.png)

å®Œæˆä»¥ä¸Šé…ç½®åï¼Œé‡å¯ä¾¿å¯ä»¥ä½¿ç”¨ï¼Œå…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯åŒæ ·çš„é…ç½®ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©å…‹éš†ï¼Œç½‘ç»œé…ç½®å’Œä¸»æœºå è®°å¾—æ”¹~ ç„¶åæˆ‘ä»¬ä¾¿å¾—åˆ°ä»¥ä¸‹é…ç½®çš„ä¸‰ä¸ªæœåŠ¡å™¨ï¼š

| ä¸»æœºå | IP              | é…ç½®                |
| ------ | --------------- | ------------------- |
| master | 192.168.108.100 | 2 æ ¸ 2Gå†…å­˜ 30Gç¡¬ç›˜ |
| node01 | 192.168.108.101 | 2 æ ¸ 2Gå†…å­˜ 30Gç¡¬ç›˜ |
| node02 | 192.168.108.102 | 2 æ ¸ 2Gå†…å­˜ 30Gç¡¬ç›˜ |

##### 2ï¼‰ç¯å¢ƒé…ç½®

å®Œæˆä»¥ä¸ŠæœåŠ¡å™¨çš„æ­å»ºåï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ **shell å·¥å…·** è¿›è¡Œè¿æ¥ï¼Œå¼€å§‹æ­å»º k8s ç¯å¢ƒ

- ä¸»æœºåè§£æ

ä¸ºäº†é›†ç¾¤èŠ‚ç‚¹é—´çš„ç›´æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹ä¸»æœºåè§£æï¼Œåˆ†åˆ«åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šç¼–è¾‘ `/etc/hosts`

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410202145.png)

- åŒæ­¥æ—¶é—´

é›†ç¾¤ä¸­çš„æ—¶é—´å¿…é¡»è¦ç²¾ç¡®ä¸€è‡´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨`chronyd`æœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´ï¼Œä¸‰å°æœåŠ¡å™¨éœ€åšåŒæ ·çš„æ“ä½œ

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410202344.png)

- ç¦ç”¨**iptables**å’Œ**firewalld**æœåŠ¡

kuberneteså’Œdockeråœ¨è¿è¡Œä¸­ä¼šäº§ç”Ÿå¤§é‡çš„**iptables**è§„åˆ™ï¼Œä¸ºäº†ä¸è®©ç³»ç»Ÿè§„åˆ™è·Ÿå®ƒä»¬æ··æ·†ï¼Œç›´æ¥å…³é—­ç³»ç»Ÿçš„è§„åˆ™ã€‚ä¸‰å°è™šæ‹Ÿæœºéœ€åšåŒæ ·æ“ä½œï¼š

```shell
# 1 å…³é—­firewalldæœåŠ¡
[root@master ~]# systemctl stop firewalld
[root@master ~]# systemctl disable firewalld
# 2 å…³é—­iptablesæœåŠ¡
[root@master ~]# systemctl stop iptables
[root@master ~]# systemctl disable iptables
```

- ç¦ç”¨**selinux**

**selinux**æ˜¯**linux**ç³»ç»Ÿä¸‹çš„ä¸€ä¸ªå®‰å…¨æœåŠ¡ï¼Œå¦‚æœä¸å…³é—­å®ƒï¼Œåœ¨å®‰è£…é›†ç¾¤ä¸­ä¼šäº§ç”Ÿå„ç§å„æ ·çš„å¥‡è‘©é—®é¢˜

```shell
# æ°¸ä¹…å…³é—­
[root@master ~]# sed -i 's/enforcing/disabled/' /etc/selinux/config
# ä¸´æ—¶å…³é—­
[root@master ~]# setenforce 0
```

- ç¦ç”¨swapåˆ†åŒº

swapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ç‰©ç†å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨å¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜

```shell
# ä¸´æ—¶å…³é—­
[root@master ~]# swapoff -a
# æ°¸ä¹…å…³é—­
[root@master ~]# vim /etc/fstab
```

æ³¨é‡Šæ‰swapåˆ†åŒºé‚£ä¸€è¡Œ

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410203051.png)

- ä¿®æ”¹**linux**çš„å†…æ ¸å‚æ•°

æˆ‘ä»¬éœ€è¦ä¿®æ”¹**linux**çš„å†…æ ¸å‚æ•°ï¼Œæ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½ï¼Œç¼–è¾‘`/etc/sysctl.d/kubernetes.conf`æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®:

```shell
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
```

æ·»åŠ åè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š

```shell
# é‡æ–°åŠ è½½é…ç½®
[root@master ~]# sysctl -p
# åŠ è½½ç½‘æ¡¥è¿‡æ»¤æ¨¡å—
[root@master ~]# modprobe br_netfilter
# æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ
[root@master ~]# lsmod | grep br_netfilter
```

åŒæ ·æ˜¯åœ¨ä¸‰å°æœåŠ¡å™¨éƒ½è¿›è¡Œæ“ä½œï¼ŒæˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406231337.png)

- é…ç½® **ipvs** åŠŸèƒ½

åœ¨**kubernetes**ä¸­**service**æœ‰ä¸¤ç§ä»£ç†æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäº**iptables**çš„ï¼Œä¸€ç§æ˜¯åŸºäº**ipvs**çš„
ç›¸æ¯”è¾ƒçš„è¯ï¼Œ**ipvs**çš„æ€§èƒ½æ˜æ˜¾è¦é«˜ä¸€äº›ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥**ipvs**æ¨¡å—

```shell
# å®‰è£…ipsetå’Œipvsadm
[root@master ~]# yum install ipset ipvsadmin -y

# æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—å†™å…¥è„šæœ¬æ–‡ä»¶
[root@master ~]# cat <<EOF > /etc/sysconfig/modules/ipvs.modules
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF
# ä¸ºè„šæœ¬æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™
[root@master ~]# chmod +x /etc/sysconfig/modules/ipvs.modules
# æ‰§è¡Œè„šæœ¬æ–‡ä»¶
[root@master ~]# /bin/bash /etc/sysconfig/modules/ipvs.modules
# æŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ
[root@master ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406231544.png)

- å®Œæˆä»¥ä¸Šé…ç½®åé‡å¯æœåŠ¡å™¨

```shell
[root@master ~]# reboot
```

##### 3ï¼‰dockerå®‰è£…

ç¬¬ä¸€æ­¥ï¼š

```shell
# è·å–é•œåƒæº
[root@master ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
```

ç¬¬äºŒæ­¥ï¼š

```shell
# å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„docker-ce
# å¿…é¡»æŒ‡å®š--setopt=obsoletes=0ï¼Œå¦åˆ™yumä¼šè‡ªåŠ¨å®‰è£…æ›´é«˜ç‰ˆæœ¬
[root@master ~]# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y
```

ç¬¬ä¸‰æ­¥ï¼š

```shell
# æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶
# Dockeråœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„Cgroup Driverä¸ºcgroupfsï¼Œè€Œkubernetesæ¨èä½¿ç”¨systemdæ¥ä»£æ›¿cgroupfs
[root@master ~]# mkdir /etc/docker
```

ç¬¬å››æ­¥ï¼š

```shell
# æ·»åŠ é˜¿é‡Œäº‘ yum æº, å¯ä»é˜¿é‡Œäº‘å®¹å™¨é•œåƒç®¡ç†ä¸­å¤åˆ¶é•œåƒåŠ é€Ÿåœ°å€
[root@master ~]# cat <<EOF > /etc/docker/daemon.json
{
"registry-mirrors": ["https://xxxx.mirror.aliyuncs.com"]
}
EOF
```

 ç¬¬äº”æ­¥ï¼š

```shell
# å¯åŠ¨docker
[root@master ~]# systemctl enable docker && systemctl start docker
```

å®Œæˆä»¥ä¸Š5æ­¥ï¼Œä¹Ÿå°±å®Œæˆäº† docker çš„å®‰è£…ï¼Œç¦»æˆåŠŸæ›´è¿‘ä¸€æ­¥~

##### 4ï¼‰é›†ç¾¤åˆå§‹åŒ–

1ã€ç”±äº **kubernetes** çš„é•œåƒæºåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå›½å†…çš„é•œåƒæº

```shell
# ç¼–è¾‘ /etc/yum.repos.d/kubernetes.repo æ·»åŠ ä¸€ä¸‹é…ç½®
[root@master ~]# vim /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410224144.png)

2ã€ç„¶åå®‰è£…**kubeadm**ã€**kubelet**å’Œ**kubectl** ä¸‰ä¸ªç»„ä»¶

```shell
yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0
kubectl-1.17.4-0 -y
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210406234940.png)

3ã€é…ç½® kubelet çš„group

```shell
# ç¼–è¾‘ /etc/sysconfig/kubeletï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®
KUBELET_CGROUP_ARGS="--cgroup-driver=systemd"
KUBE_PROXY_MODE="ipvs"
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410224600.png)

4ã€è¿™æ­¥æ˜¯æ¥åˆå§‹åŒ–é›†ç¾¤çš„ï¼Œ`å› æ­¤åªéœ€åœ¨ master æœåŠ¡å™¨ä¸Šæ‰§è¡Œå³å¯`ï¼Œä¸Šé¢é‚£äº›æ˜¯æ¯ä¸ªæœåŠ¡å™¨éƒ½éœ€è¦æ‰§è¡Œï¼

```shell
# åˆ›å»ºé›†ç¾¤
# ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€ k8s.gcr.io å›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€
[root@master ~]# kubeadm init \
--apiserver-advertise-address=192.168.108.100 \
--image-repository registry.aliyuncs.com/google_containers \
--kubernetes-version=v1.17.4 \
--pod-network-cidr=10.244.0.0/16 \
--service-cidr=10.96.0.0/12 

#ä½¿ç”¨ kubectl å·¥å…·
[root@master ~]# mkdir -p $HOME/.kube
[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210407000601.png)

ç„¶åæˆ‘ä»¬éœ€è¦å°†**node** èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ï¼Œåœ¨ `node æœåŠ¡å™¨` ä¸Šæ‰§è¡Œä¸Šè¿°çº¢æ¡†çš„å‘½ä»¤ï¼š

```shell
[root@master ~]# kubeadm join 192.168.108.100:6443 --token xxx \ 
--discovery-token-ca-cert-hash sha256:xxx
```

ä¾¿å¯åœ¨ **master èŠ‚ç‚¹** è·å–åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210407000758.png)

ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªæ—¶å€™æŸ¥çœ‹é›†ç¾¤çŠ¶æ€éƒ½æ˜¯ä¸º`NotReady`ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰é…ç½®ç½‘ç»œæ’ä»¶

5ã€å®‰è£…ç½‘ç»œæ’ä»¶

**kubernetes**æ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œæ¯”å¦‚**flannel**ã€**calico**ã€**canal**ç­‰ç­‰ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨**flanne**

ä¸‹è½½ **flanneld-v0.13.0-amd64.docker**  ï¼š[ä¸‹è½½åœ°å€](https://github.com/flannel-io/flannel/releases/)

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410230531.png)

ä¸‹è½½å®Œæˆåï¼Œä¸Šä¼ è‡³ **master æœåŠ¡å™¨** æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```shell
docker load < flanneld-v0.13.0-amd64.docker
```

æ‰§è¡Œå®Œæˆåä¾¿å¯çœ‹åˆ°å¤šäº†ä¸ª **flannel** é•œåƒï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410230737.png)

ç„¶åæˆ‘ä»¬éœ€è¦è·å–**flannel**çš„é…ç½®æ–‡ä»¶æ¥éƒ¨ç½² **flannel** æœåŠ¡

```shell
[root@master ~]# wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨fannel
[root@master ~]# kubectl apply -f kube-flannel.yml

# å†æ¬¡æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€
[root@master ~]# kubectl get nodes
```

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410180812.png)

è¿™ä¸ªæ—¶å€™æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€éƒ½æ˜¯`Ready` çš„çŠ¶æ€ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ **k8s** é›†ç¾¤å°±ç®—æ­å»ºå®Œæˆäº†ï¼

##### 5ï¼‰é›†ç¾¤åŠŸèƒ½éªŒè¯

æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬çš„éªŒè¯æ—¶é—´ï¼Œä¹‹å‰æˆ‘ä»¬å­¦ **docker** çš„æ—¶å€™å¾€å¾€ä¼šå¯åŠ¨ä¸€ä¸ª **nginx** å®¹å™¨æ¥æµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œ**k8s** æˆ‘ä»¬ä¹ŸåŒæ ·æ¥éƒ¨ç½²ä¸€ä¸ª **nginx** æ¥æµ‹è¯•ä¸‹æœåŠ¡æ˜¯å¦å¯ç”¨~ 

ï¼ˆä¸‹é¢ä¾‹å­ä¸ºæµ‹è¯•ä¾‹å­ï¼Œå¦‚æœä¸æ¸…æ¥šæ¯ä¸ªæŒ‡ä»¤çš„ä½œç”¨ä¹Ÿä¸è¦ç´§ï¼Œåé¢æˆ‘ä»¬ä¼šå‡ºç¯‡ k8s çš„æ•™å­¦æ–‡ç« æ¥è¯´æ˜ **k8s** å¦‚æœä½¿ç”¨ï¼ï¼‰

- é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª deployment

```shell
[root@master ~]# kubectl create deployment nginx --image=nginx:1.14-alpine
deployment.apps/nginx created

[root@master ~]# kubectl get deploy
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   1/1     1            1           31s
```

- ç„¶ååˆ›å»ºä¸€ä¸ª service æ¥è®©å¤–ç•Œèƒ½å¤Ÿè®¿é—®åˆ°æˆ‘ä»¬ nginx æœåŠ¡

```shell
[root@master ~]# kubectl expose deploy nginx --port=80 --target-port=80 --type=NodePort
service/nginx exposed

[root@master ~]# kubectl get svc 
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
nginx        NodePort    10.110.224.214   <none>        80:31771/TCP   5s
```

ç„¶åæˆ‘ä»¬é€šè¿‡ node èŠ‚ç‚¹çš„ IP åŠ ä¸Šservice æš´éœ²å‡ºæ¥çš„ nodePort æ¥è®¿é—®æˆ‘ä»¬çš„ nginx æœåŠ¡ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410180733.png)

ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é›†ç¾¤ä¸­é€šè¿‡ service çš„ IP åŠ ä¸Šæ˜ å°„å‡ºæ¥çš„ port æ¥è®¿é—®æˆ‘ä»¬çš„æœåŠ¡ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410180753.png)

ä»ç»“æœä¸Šçœ‹ä¸¤ç§è®¿é—®éƒ½æ˜¯å¯ç”¨çš„ï¼Œè¯´æ˜æˆ‘ä»¬çš„ **nginx** æœåŠ¡éƒ¨ç½²æˆåŠŸï¼Œä¸å¦¨ç‚¹ä¸ªå…³æ³¨åŠ©åŠ©å…´~

> å…¬ä¼—å·æœç´¢ï¼šå°èœè‰¯è®°
>
> æ›´å¤šå¹²è´§å€¼å¾—é˜…è¯»å“¦ï¼

é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è®¿é—®åˆ° **nginx**ï¼Ÿæˆ‘ä»¬ä¸å¦¨ç»“åˆä¸Šé¢è¯´åˆ°çš„ k8s ç»„ä»¶æ¥æ¢³ç†ä¸€ä¸‹å„ä¸ªç»„ä»¶çš„è°ƒç”¨å…³ç³»ï¼š

![](https://gitee.com/cbuc/picture/raw/master/typora/20210410181842.png)

1. **kubernetes** å¯åŠ¨åï¼Œæ— è®ºæ˜¯ **master** èŠ‚ç‚¹ äº¦æˆ–è€… **node** èŠ‚ç‚¹ï¼Œéƒ½ä¼šå°†è‡ªèº«çš„ä¿¡æ¯å­˜å‚¨åˆ° **etcd** æ•°æ®åº“ä¸­

2. åˆ›å»º **nginx** æœåŠ¡ï¼Œé¦–å…ˆä¼šå°†å®‰è£…è¯·æ±‚å‘é€åˆ° **master** èŠ‚ç‚¹ä¸Šçš„ **apiServer** ç»„ä»¶ä¸­

3. **apiServer** ç»„ä»¶ä¼šè°ƒç”¨ **scheduler** ç»„ä»¶æ¥å†³å®šåº”è¯¥å°†è¯¥æœåŠ¡å®‰è£…åˆ°å“ªä¸ª **node** èŠ‚ç‚¹ä¸Šã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° **etcd** æ•°æ®åº“äº†ï¼Œ**scheduler**ä¼šä» **etcd** ä¸­è¯»å–å„ä¸ª **node** èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥ç»™ **apiServer**

4. **apiServer** è°ƒç”¨ **controllerManager** å»è°ƒåº¦ **node** èŠ‚ç‚¹ï¼Œå¹¶å®‰è£… **nginx** æœåŠ¡

5. **node** èŠ‚ç‚¹ä¸Šçš„ **kubelet** ç»„ä»¶æ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥**docker**ï¼Œç„¶åç”± **docker** æ¥å¯åŠ¨ä¸€ä¸ª **nginx** çš„**pod**

   > **pod** æ˜¯ **kubernetes** ä¸­çš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è·‘åœ¨ **pod** ä¸­

6. ä»¥ä¸Šæ­¥éª¤å®Œæˆåï¼Œ**nginx** æœåŠ¡ä¾¿è¿è¡Œèµ·æ¥äº†ï¼Œå¦‚æœéœ€è¦è®¿é—® **nginx**ï¼Œå°±éœ€è¦é€šè¿‡ **kube-proxy** æ¥å¯¹ **pod** äº§ç”Ÿè®¿é—®çš„ä»£ç†ï¼Œè¿™æ ·å¤–éƒ¨ç”¨æˆ·å°±èƒ½è®¿é—®åˆ°è¿™ä¸ª **nginx** æœåŠ¡

ä»¥ä¸Šä¾¿æ˜¯è¿è¡Œä¸€ä¸ªæœåŠ¡çš„å…¨è¿‡ç¨‹ï¼Œä¸çŸ¥é“çœ‹å®Œä¹‹åæœ‰æ²¡æœ‰ä¸€ç§ `è‚ƒç„¶èµ·æ•¬` çš„æ„Ÿè§‰ï¼Œè®¾è®¡æ˜¯åœ¨å¤ªå·§å¦™äº†ï¼Œå› æ­¤åˆ°è¿™é‡Œï¼Œéš¾é“å°±ä¸å‡†å¤‡çœ‹ k8s ä½¿ç”¨ä¸‹æ–‡ï¼å¦‚æœå‡†å¤‡çœ‹çš„è¯ï¼Œå°æ‰‹å°†å…³æ³¨ç‚¹èµ·æ¥å“¦ï¼

**END**

ä»¥ä¸Šä¾¿æ˜¯ **k8s** é›†ç¾¤çš„æ­å»ºè¿‡ç¨‹ï¼Œæœ‰äº† **k8s** çš„ç¯å¢ƒï¼Œä½ è¿˜æ€•å­¦ä¸ä¼š **k8s** çš„ä½¿ç”¨å—ï¼åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šå°½æƒ…æŠ˜è…¾ï¼Œå¼„åäº†ä¹Ÿå°±ä¸€ä¸ªæ¢å¤å¿«ç…§çš„äº‹~ æˆ‘æ˜¯å°èœï¼Œè·¯æ¼«æ¼«ï¼Œä¸ä½ ä¸€åŒæ±‚ç´¢ï¼

![çœ‹å®Œä¸èµï¼Œéƒ½æ˜¯åè›‹](https://gitee.com/cbuc/picture/raw/master/typora/20210410232040.png)

> ä»Šå¤©çš„ä½ å¤šåŠªåŠ›ä¸€ç‚¹ï¼Œæ˜å¤©çš„ä½ å°±èƒ½å°‘è¯´ä¸€å¥æ±‚äººçš„è¯ï¼
>
> *æˆ‘æ˜¯å°èœï¼Œä¸€ä¸ªå’Œä½ ä¸€èµ·å­¦ä¹ çš„ç”·äººã€‚* `ğŸ’‹`
>
>
> å¾®ä¿¡å…¬ä¼—å·å·²å¼€å¯ï¼Œ**å°èœè‰¯è®°**ï¼Œæ²¡å…³æ³¨çš„åŒå­¦ä»¬è®°å¾—å…³æ³¨å“¦ï¼