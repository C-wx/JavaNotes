å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°èœï¼Œä¸€ä¸ªæ¸´æœ›åœ¨äº’è”ç½‘è¡Œä¸šåšåˆ°è”¡ä¸èœçš„å°èœã€‚å¯æŸ”å¯åˆšï¼Œç‚¹èµåˆ™æŸ”ï¼Œç™½å«–åˆ™åˆšï¼
**æ­»é¬¼~çœ‹å®Œè®°å¾—ç»™æˆ‘æ¥ä¸ªä¸‰è¿å“¦ï¼**


![](https://user-gold-cdn.xitu.io/2020/4/11/17169c46045528af?w=240&h=224&f=jpeg&s=7529)


>æœ¬æ–‡ä¸»è¦ä»‹ç» `Jenkins`
>
>å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥å‚è€ƒ
>
>å¦‚æœ‰å¸®åŠ©ï¼Œä¸å¿˜ **ç‚¹èµ** â¥
>
>
>å¾®ä¿¡å…¬ä¼—å·å·²å¼€å¯ï¼Œ**å°èœè‰¯è®°**ï¼Œæ²¡å…³æ³¨çš„åŒå­¦ä»¬è®°å¾—å…³æ³¨å“¦ï¼

â€œå”‰ï¼Œæ¯å¤©æäº¤å®Œä»£ç éƒ½å¾—è‡ªå·±æ‰“åŒ…å†éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒï¼Œå¥½éº»çƒ¦å•Šï¼éƒ½å¿«å˜æˆè¿ç»´äº†â€

â€œå•Šï¼Ÿå“¦ï¼ç¡®å®ï¼Œæ¯å¤©æ‰“åŒ…éƒ¨ç½²ç¡®å®éƒ½æˆä¸ºäº†å·¥å…·äººäº†â€

ä¸€æ®µç®€ç™½çš„å¯¹è¯å¿«é€Ÿçš„éšç­åœ¨åŠå…¬å®¤ä¸­ï¼Œå´å¼•å‘äº†æˆ‘çš„æ€è€ƒï¼Œâ€œè¿™ä¹ˆéº»çƒ¦çš„è¿‡ç¨‹è‚¯å®šå·²ç»æœ‰äº†å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯•ç«Ÿç¨‹åºå‘˜æ˜¯`é¢å‘æ‡’æƒ°ç¼–ç¨‹`ï¼Œè‡ªå·±å¯¹ **Jenkins** è¿™ä¸ªå·¥å…·æœ‰æ‰€è€³é—»å·²ç»å¾ˆä¹…äº†ï¼Œçœ‹æ¥ä»Šå¤©å¾—å¯¹å®ƒ`ä¸‹æ‰‹`äº†â€

è¯´å¹²å°±å¹²ï¼Œä»Šå¤©å’±ä»¬å°±æ¥æ±‚ç´¢ä¸€ä¸‹ **JenKins**ï¼Œçœ‹å®Œä½ ä¸å¦¨ä¹Ÿç»™ä½ ä»¬é¡¹ç›®æ•´ä¸€ä¸ªï¼Œç»™è‡ªå·±å¤šå¢åŠ ç‚¹`åˆ’æ°´`çš„æ—¶é—´ï¼

![](https://cbuc.top/1607594479667.gif)

> **è¯»å‰é¡»çŸ¥ï¼š** æœ¬æ–‡è¾ƒé•¿ï¼Œä»å®‰è£…åˆ°ä½¿ç”¨ï¼Œä¸€æ­¥æ­¥å¸¦ä½ è¶…ç¥ï¼
>
> **å¾®ä¿¡å…¬ä¼—å·å…³æ³¨ï¼š** `[ å°èœè‰¯è®° ]` ï¼Œå¸¦ä½ é¢†ç•¥æŠ€æœ¯é£éªšï¼

## ä¸€ã€Jenkins æ˜¯ä»€ä¹ˆ

> Jenkinsæ˜¯ä¸€ä¸ª`å¼€æºè½¯ä»¶`é¡¹ç›®ï¼Œæ˜¯åŸºäº`java`å¼€å‘çš„ä¸€ç§`æŒç»­é›†æˆ`å·¥å…·ï¼Œç”¨äºç›‘æ§æŒç»­é‡å¤çš„å·¥ä½œï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¼€æ”¾æ˜“ç”¨çš„è½¯ä»¶å¹³å°ï¼Œä½¿è½¯ä»¶çš„æŒç»­é›†æˆå˜æˆå¯èƒ½ã€‚

ç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª **æŒç»­é›†æˆ** çš„å·¥å…·ï¼

### 1. æŒç»­é›†æˆ

**æŒç»­é›†æˆ**ï¼ˆContinuous Integrationï¼‰ï¼Œç®€ç§° **CI**ã€‚é¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚é€šè¿‡æŒç»­é›†æˆï¼Œå›¢é˜Ÿå¯ä»¥å¿«é€Ÿä»ä¸€ä¸ªåŠŸèƒ½åˆ°å¦å¤–ä¸€ä¸ªåŠŸèƒ½ã€‚

![](https://cbuc.top/1607063047968.png)

**å¥½å¤„ï¼š**

- é™ä½é£é™©ï¼Œç”±äºæŒç»­é›†æˆä¸æ–­å»æ„å»ºï¼Œç¼–è¯‘å’Œæµ‹è¯•ï¼Œå¯ä»¥å¾ˆæ—©å‘ç°é—®é¢˜
- å‡å°‘é‡å¤æ€§çš„å·¥ä½œ
- æŒç»­éƒ¨ç½²ï¼Œæä¾›å¯éƒ¨ç½²å•å…ƒåŒ…
- æŒç»­äº¤ä»˜å¯ä¾›ä½¿ç”¨çš„ç‰ˆæœ¬

### 2. Jenkins æŒç»­é›†æˆ

![](https://cbuc.top/1607065613065.png)

æˆ‘ä»¬å…ˆé€šè¿‡è¿™å¼ å›¾æ¥çœ‹åˆ° **Jenkins** åœ¨å…¶ä¸­èµ·åˆ°çš„ä½œç”¨ï¼š

- é¦–å…ˆï¼Œå¼€å‘äººå‘˜å°†ä»£ç æäº¤åˆ° **Git** ä»“åº“
- ç„¶å **Jenkins** ä½¿ç”¨ **Git** æ’ä»¶æ¥æ‹‰å– **Git** ä»“åº“çš„ä»£ç ï¼Œç„¶åé…åˆ **JDKã€Maven** ç­‰è½¯ä»¶å®Œæˆä»£ç ç¼–è¯‘ï¼Œæµ‹è¯•ã€å®¡æŸ¥ã€ã€æµ‹è¯•å’Œæ‰“åŒ…ç­‰å·¥ä½œ
- æœ€å **Jenkins** å°†ç”Ÿæˆçš„ **jar/war** æ¨é€åˆ° **æµ‹è¯•/ç”Ÿäº§ æœåŠ¡å™¨** ï¼Œä¾›ç”¨æˆ·è®¿é—®

æ•´å¥—æ­¥éª¤ä¸‹æ¥ï¼Œä½œä¸ºå¼€å‘äººå‘˜æˆ‘ä»¬åªéœ€è¦æäº¤ä¸‹ä»£ç ï¼Œå‰©ä¸‹çš„å·¥ä½œéƒ½äº¤ç»™äº† **Jenkins** ï¼ŒçœŸæ˜¯ç¾æ»‹æ»‹ï¼Œæ€ä¹ˆæ²¡æœ‰æ—©ç‚¹ä¸Šè¿™ä¸ªå·¥å…·çš„è½¦ï¼

## äºŒã€Jenkins å®‰è£…

ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼Œæ²¡åˆ€çš„æƒ…å†µä¸‹è¯´å†å¤šéƒ½æ˜¯è™šçš„ã€‚æˆ‘ä»¬å°±å…ˆæ¥çœ‹ä¸‹ **Jenkins** æ˜¯å¦‚ä½•å®‰è£…çš„å§ï¼

### 1. å®‰è£…JDK

å› ä¸º **Jenkins** æ˜¯ **java** å†™çš„ï¼Œæ‰€ä»¥è¦è¿è¡Œèµ·æ¥å¿…é¡»è¦é…ç½® **java** è¿è¡Œç¯å¢ƒã€‚è¿™é‡Œå°±ä¸èµ˜è¯‰ JDK çš„å®‰è£…è¿‡ç¨‹äº†

### 2. ä¸‹è½½å®‰è£… Jenkins

- **ä¸‹è½½**

æˆ‘ä»¬å¯ä»¥è¿›å…¥ä¸‹è½½é¡µé¢é€‰æ‹©æˆ‘ä»¬è¦å®‰è£…çš„ç‰ˆæœ¬ï¼š[ä¸‹è½½åœ°å€](https://www.jenkins.io/zh/download/)ï¼Œ æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ ï¼š`jenkins-2.190.3-1.1.noarch.rpm`

- **å®‰è£…**

ç„¶åæŠŠä¸‹è½½å¥½çš„ **rpm** åŒ…ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œé€šè¿‡ `rpm -ivh jenkins-2.190.3-1.1.noarch.rpm` è¿›è¡Œå®‰è£…ï¼Œç„¶åç¼–è¾‘ `etc` ç›®å½•ä¸‹çš„ **jenkins** é…ç½®æ–‡ä»¶ï¼š`vim /etc/sysconfig/jenkins`ï¼Œéœ€è¦æ”¹çš„åœ°æ–¹å¦‚ä¸‹ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©ä¸æ”¹ï¼‰ï¼š

```properties
JENKINS_USER="root"
JENKINS_PORT="8888"
```

- **å¯åŠ¨**

`systemctl start jenkins`

- **è®¿é—®**

é€šè¿‡æµè§ˆå™¨è®¿é—® `http://æœåŠ¡å™¨IP:8888/`ï¼Œçœ‹åˆ°ä»¥ä¸‹é¡µé¢è¯´æ˜å¯åŠ¨æˆåŠŸäº†

![](https://cbuc.top/1607067896468.png)

ç„¶åæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šä»æŒ‡å®šæ–‡ä»¶ä¸­è·å–å¯†ç ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥ã€‚

è¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å…ˆè·³è¿‡æ’ä»¶å®‰è£…ï¼Œå› ä¸º**Jenkins**æ’ä»¶éœ€è¦è¿æ¥é»˜è®¤å®˜ç½‘ä¸‹è½½ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼š

![](https://cbuc.top/1607070823549.png)

ç„¶åæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜è´¦å·æ¥ç®¡ç†ï¼š

![](https://cbuc.top/1607070841631.png)

çœ‹åˆ°ä»¥ä¸‹é¡µé¢å°±è¯´æ˜è®¾ç½®æˆåŠŸäº†ï¼š

![](https://cbuc.top/1607264518370.png)

> å¾®ä¿¡å…¬ä¼—å·å…³æ³¨ï¼š**å°èœè‰¯è®°** ï¼Œå¸¦ä½ é¢†ç•¥æŠ€æœ¯é£éªšï¼

## ä¸‰ã€Jenkins ä½¿ç”¨

### 1. æ’ä»¶åŠ é€Ÿ

> å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨

è´´å¿ƒçš„å°èœæ˜¯ä¸ä¼šè®©ä½ é­å—ç­‰å¾…çš„ç—›è‹¦çš„ï¼Œé¦–å…ˆæˆ‘ä»¬è¿›å…¥ `Jenkins -> Manage Jenkins -> Manage Plugins` ï¼Œç‚¹å‡» `install` 

![](https://cbuc.top/1607653359244.png)

ç„¶åæˆ‘ä»¬åœ¨å®‰è£… **Jenkins** çš„æœåŠ¡å™¨ä¸Šè¿›å…¥ `/var/lib/jenkins/updates` ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ª `default.json` æ–‡ä»¶ï¼Œ**ç¬¬ä¸€æ­¥ï¼š**æˆ‘ä»¬éœ€è¦æ›¿æ¢é‡Œé¢çš„éƒ¨åˆ†å­—æ®µï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹ï¼š

```shell
sudo sed -i 's#updates.jenkins.io/download/plugins#mirrors.tuna.tsinghua.edu.cn/jenkins/plugins#g' default.json && sudo sed -i 's#www.google.com#www.baidu.com#g' default.json
```

**ç¬¬äºŒæ­¥ï¼š**æˆ‘ä»¬è¿›å…¥åˆ° `/var/lib/jenkins`ç›®å½•ï¼Œç¼–è¾‘ ` hudson.model.UpdateCenter.xm`ï¼Œå°†é‡Œé¢çš„ `https://updates.jenkins.io/update-center.json`ä¿®æ”¹ä¸º `http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json`

**æœ€åä¸€æ­¥ï¼š** è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œé‡å¯ **Jenkins** ï¼š

```shell
systemctl restart jenkins
```

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„å®‰è£…æ’ä»¶äº†ï¼

### 2. ç”¨æˆ·ç®¡ç†

åœ¨ **Jenkins** ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œç”¨æˆ·æƒé™ç®¡ç†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å€ŸåŠ©æ’ä»¶ `Role-based Authorization Strategy` 

- **é¦–å…ˆå®‰è£… `Role-based Authorization Strategy` æ’ä»¶**

![](https://cbuc.top/1607087167914.png)

- **å¼€å¯å…¨å±€å®‰å…¨é…ç½®**

![](https://cbuc.top/1607265662959.png)

å°†æˆæƒç­–ç•¥åˆ‡æ¢ä¸º `"Role-Based Strategy"`

![](https://cbuc.top/1607266045131.png)



- **åˆ›å»ºç”¨æˆ·**

æ›´æ”¹å®Œæˆæƒç­–ç•¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆ›å»ºç”¨æˆ·äº†ï¼Œè¿›å…¥ç³»ç»Ÿç®¡ç†é¡µé¢ä¸­çš„`Manage Users`

![](https://cbuc.top/1607266133097.png)

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªç”¨æˆ·ï¼Œåˆ†åˆ«æ˜¯ `cbuc1` å’Œ `cbuc2`

![](https://cbuc.top/1607267870545.png)

- **åˆ›å»ºè§’è‰²**

åˆ›å»ºå¥½ç”¨æˆ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆ›å»ºè§’è‰²äº†ï¼Œåœ¨ç³»ç»Ÿç®¡ç†é¡µé¢è¿›å…¥ `Manage and Assign Roles`

![](https://cbuc.top/1607267910157.png)

è§’è‰²ä¸»è¦åˆ†ä¸º **Global rolesï¼ˆå…¨å±€è§’è‰²ï¼‰** å’Œ **Item rolesï¼ˆé¡¹ç›®è§’è‰²ï¼‰**

**Global rolesï¼ˆå…¨å±€è§’è‰²ï¼‰ï¼š** ç®¡ç†å‘˜ç­‰é«˜çº§ç”¨æˆ·å¯ä»¥åˆ›å»ºåŸºäºå…¨å±€çš„è§’è‰²

**Item rolesï¼ˆé¡¹ç›®è§’è‰²ï¼‰ï¼š** é’ˆå¯¹æŸä¸ªæˆ–è€…æŸäº›é¡¹ç›®çš„è§’è‰²

![](https://cbuc.top/1607267910157.png)

æˆ‘ä»¬ç³»ç»Ÿç°åœ¨å·²ç»å­˜åœ¨äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç»™è¿™ä¸¤ä¸ªç”¨æˆ·ç»‘å®šå¯¹åº”çš„è§’è‰²

![](https://cbuc.top/1607268164551.png)

### 3. å‡­è¯ç®¡ç†

ä»€ä¹ˆæ˜¯å‡­è¯å‘¢ï¼Ÿ **å‡­è¯** å¯ä»¥ç”¨æ¥å­˜å‚¨éœ€è¦å¯†æ–‡ä¿æŠ¤çš„æ•°æ®åº“å¯†ç ï¼Œ**GitLab** å¯†ç ä¿¡æ¯ï¼Œ**Docker** ç§æœ‰ä»“åº“çš„ç™»å½•å¯†ç ã€‚ä¿å­˜äº†è¿™äº›ä¿¡æ¯åï¼Œ**Jenkins** å°±å¯ä»¥å’Œè¿™äº›ç¬¬ä¸‰æ–¹çš„åº”ç”¨è¿›è¡Œäº¤äº’ã€‚å½“ç„¶ï¼Œè¿™è¿˜æ˜¯å¾—å€ŸåŠ© **Jenkins** çš„æ’ä»¶ï¼

#### 1ï¼‰å®‰è£…

é¦–å…ˆå®‰è£… `Credentials Binding` æ’ä»¶

![](https://cbuc.top/1607088143834.png)

å®‰è£…å¥½æ’ä»¶åï¼Œåœ¨ç³»ç»Ÿé¦–è¦çš„èœå•æ ä¸­å°±ä¼šå¤šäº†ä¸ª **å‡­è¯** èœå•

![](https://cbuc.top/1607266556053.png)

ç‚¹å‡»è¿›å»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯ä»¥æ·»åŠ çš„å‡­è¯æœ‰ **5** ç§ï¼š

![](https://cbuc.top/1607088287034.png)

1. **Username with password** ï¼šç”¨æˆ·åå’Œå¯†ç 
2. **SSH Username with private keyï¼š** ä½¿ç”¨ **SSH** ç”¨æˆ·å’Œå¯†é’¥
3. **Secret fileï¼š** éœ€è¦ä¿å¯†çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨æ—¶ **Jenkins** ä¼šå°†æ–‡ä»¶å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå†å°†æ–‡ä»¶è·¯å¾„è®¾ç½®åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œç­‰æ„å»ºç»“æŸåï¼Œæ‰€å¤åˆ¶çš„ **Secret file** å°±ä¼šè¢«åˆ é™¤
4. **Secret textï¼š** éœ€è¦ä¿å­˜çš„ä¸€ä¸ªåŠ å¯†çš„æ–‡æœ¬ä¸²ï¼Œå¦‚é’‰é’‰æœºå™¨äººæˆ– **GitHub** çš„ **api token**
5. **Certificateï¼š** é€šè¿‡ä¸Šä¼ è¯ä¹¦æ–‡ä»¶çš„æ–¹å¼

æˆ‘ä»¬å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨çš„ç±»å‹ä¸ºï¼š`Username with password` å’Œ `SSH Username with private key`

#### 2ï¼‰Git å‡­è¯ç®¡ç†

æˆ‘ä»¬å¦‚æœè¦ä½¿ç”¨ **Jenkins** ä» **GitLab** æ‹‰å–é¡¹ç›®ä»£ç ï¼Œæˆ‘ä»¬å°±å¾—ä½¿ç”¨å‡­è¯æ¥éªŒè¯ã€‚

- å®‰è£… **Git** æ’ä»¶

æˆ‘ä»¬éœ€è¦åœ¨ **Jenkins** ä¸­å®‰è£… **Gitæ’ä»¶** æ¥æ‹‰å–é¡¹ç›®ä»£ç 

![](https://cbuc.top/1607266887281.png)

ç„¶åæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šä¹Ÿéœ€è¦å®‰è£… **Git å·¥å…·**ï¼š

```shell
# å®‰è£…å‘½ä»¤
yum install git -y
# éªŒè¯å‘½ä»¤
git --version
```

##### 1. æ–¹å¼1ï¼šç”¨æˆ·å¯†ç ç±»å‹

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **ç”¨æˆ·å¯†ç ** ç™»å½•åæ‹‰å–é¡¹ç›®ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨åˆ° **å‡­è¯çš„ Username with password ç±»å‹**ï¼š

![](https://cbuc.top/1607266676993.png)

![](https://cbuc.top/1607266697804.png)

åˆ›å»ºæˆåŠŸæˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª **FreeStyle é¡¹ç›®**

![](https://cbuc.top/1607306912845.png)

ç„¶ååœ¨ **GitLab** ä¸­å¤åˆ¶æˆ‘ä»¬é¡¹ç›®çš„ **URL**

![](https://cbuc.top/1607594017275.png)

åœ¨ **Credentials** ä¸­é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„å‡­è¯ï¼Œä¿å­˜é…ç½®åï¼Œæˆ‘ä»¬ç‚¹å‡» **Build Now** æ¥æ„å»ºé¡¹ç›®ï¼š

![](https://cbuc.top/1607307063370.png)

è¿™ä¸ªæ—¶å€™åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡º

![](https://cbuc.top/1607307086430.png)

ç„¶ååœ¨è¿›å…¥æœåŠ¡å™¨çš„ `/var/lib/jenkins/workspace` ç›®å½•ä¸­çœ‹åˆ°æˆ‘ä»¬æ‹‰å–çš„é¡¹ç›®ï¼š

![](https://cbuc.top/1607307212593.png)

è¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸä½¿ç”¨ **ç”¨æˆ·å¯†ç ** å‡­è¯æ¨¡å¼æ‹‰å–åˆ° **Gité¡¹ç›®äº†**

##### 2. æ–¹å¼2ï¼šSSHå¯†é’¥ç±»å‹

é™¤äº†ç”¨è´¦å·å¯†ç æ–¹å¼æ¥éªŒè¯ **Git** ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ **SSHå¯†é’¥** æ¥éªŒè¯ï¼Œæ­¥éª¤æµç¨‹å¦‚ä¸‹ï¼š

![](https://cbuc.top/1607308765334.png)

ä»å›¾ä¸Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œç¬¬ä¸€æ­¥éœ€è¦ç”Ÿæˆ **å…¬ç§é’¥**ï¼Œæˆ‘ä»¬åœ¨ **JenkinsæœåŠ¡å™¨** ä¸Šè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ç”Ÿæˆï¼š

`ssh-keygen -t rsa` è¾“å…¥æŒ‡ä»¤åï¼Œä¸€è·¯å›è½¦ï¼Œä¾¿å¯åœ¨ `/root/.ssh/` ç›®å½•ä¸‹ç”Ÿæˆå…¬ç§é’¥ï¼š

 ![](https://cbuc.top/1607307581897.png)

- **id_rsa**ï¼šç§é’¥æ–‡ä»¶
- **id_rsa.pub**ï¼šå…¬é’¥æ–‡ä»¶

ç„¶åæˆ‘ä»¬æŠŠç”Ÿæˆçš„å…¬é’¥æ”¾åœ¨ **GitLab** ä¸­ï¼Œ`rootè´¦æˆ·ç™»å½•->ç‚¹å‡»å¤´åƒ->Settings->SSH Keys`ï¼Œå¤åˆ¶ **id_rsa.pub** ä¸­çš„å†…å®¹ï¼Œç‚¹å‡» **"Add key"**

![](https://cbuc.top/1607307814247.png)

ç„¶åæˆ‘ä»¬å†å›åˆ° **Jenkins** ç³»ç»Ÿé¡µé¢ä¸­æ·»åŠ å‡­è¯ï¼Œé€‰æ‹© `SSH Username with private key` ï¼ŒæŠŠåˆšåˆšç”Ÿæˆçš„ç§æœ‰æ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡æ¥

![](https://cbuc.top/1607307983449.png)

æ·»åŠ åå°±ä¼šç”Ÿæˆä¸€æ¡å‡­è¯

![](https://cbuc.top/1607308020593.png)

åˆ›å»ºæˆåŠŸæˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª **FreeStyle é¡¹ç›®**

![](https://cbuc.top/1607308070922.png)

ç„¶ååœ¨ **GitLab** ä¸­å¤åˆ¶æˆ‘ä»¬é¡¹ç›®çš„ **URL**

![](https://cbuc.top/1607308410091.png)

åœ¨ **Credentials** ä¸­é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„å‡­è¯ï¼Œä¿å­˜é…ç½®åï¼Œæˆ‘ä»¬ç‚¹å‡» **Build Now** æ¥æ„å»ºé¡¹ç›®ï¼š

![](https://cbuc.top/1607308489735.png)

è¿™ä¸ªæ—¶å€™åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡º

![](https://cbuc.top/1607308526228.png)

ç„¶ååœ¨è¿›å…¥æœåŠ¡å™¨çš„ `/var/lib/jenkins/workspace` ç›®å½•ä¸­çœ‹åˆ°æˆ‘ä»¬æ‹‰å–çš„é¡¹ç›®ï¼š

![](https://cbuc.top/1607308613232.png)

è¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸä½¿ç”¨ **SSH Username with private key** å‡­è¯æ¨¡å¼æ‹‰å–åˆ° **Gité¡¹ç›®äº†**

### 4. é¡¹ç›®ç®¡ç†

#### 1ï¼‰Maven å®‰è£…

æˆ‘ä»¬ç°åœ¨å¼€å‘ä¸­çš„é¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯ **Maven** é¡¹ç›®ï¼Œä½¿ç”¨ **Maven** é¡¹ç›®ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ **ä¾èµ–ç®¡ç†**ï¼Œå› æ­¤æˆ‘ä»¬åº”å½“åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… **Maven** æ¥ä¸‹è½½é¡¹ç›®ä¾èµ–ã€‚

- **å®‰è£… Maven**

æˆ‘ä»¬å¯ä»¥ä» **Maven** å®˜ç½‘ä¸Šä¸‹è½½å‹ç¼©åŒ…ï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šè¿›è¡Œè§£å‹

`tar -xzf apache-maven-3.6.0-bin.tar.gz`

- **é…ç½®ç¯å¢ƒå˜é‡**

`vim /etc/profile`

```shell
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk
export MAVEN_HOME=/home/maven/apache-maven-3.6.2
export PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin
```

ç¼–è¾‘åä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼š

```shell
source /etc/profile
```

éªŒè¯ï¼š

```shell
mvn -v
```

ç„¶åè®¾ç½® **Maven** çš„ `settings.xml`

```shell
# åˆ›å»ºæœ¬åœ°ä»“åº“ç›®å½•
mkdir /data/localRepo
vim /home/maven/apache-maven-3.6.2/conf/settings.xml
```

å°†æœ¬åœ°ä»“åº“æ”¹ä¸ºï¼š `/root/repo/`

æ·»åŠ é˜¿é‡Œäº‘ç§æœåœ°å€ï¼š`alimaven aliyun maven http://maven.aliyun.com/nexus/content/groups/public/ central`

- **Jenkinsé…ç½®**

åœ¨ **Jenkins** æˆ‘ä»¬ä¹Ÿéœ€è¦é…ç½® **JDK** å’Œ **Maven** çš„å…³è”.

è¿›å…¥ `Jenkins -> Global Tool Configuration -> JDK`

![](https://cbuc.top/1607593766261.png)

è¿›å…¥ `Jenkins -> Global Tool Configuration -> Maven`

![](https://cbuc.top/1607309560875.png)

**æ·»åŠ å…¨å±€å˜é‡**

è¿›å…¥`Manage Jenkins->Configure System->Global Properties`ï¼Œæ·»åŠ ä¸‰ä¸ªå…¨å±€å˜é‡

**JAVA_HOMEã€M2_HOMEã€PATH+EXTRA**

![](https://cbuc.top/1607311536652.png)

ç„¶åæˆ‘ä»¬è¿›å…¥é¡¹ç›®ä¸­ç‚¹å‡» **configure**

![](https://cbuc.top/1607311591261.png)

ç„¶åæ·»åŠ  **shell** æ‰§è¡Œè„šæœ¬ï¼š

![](https://cbuc.top/1607311622735.png)

ä¿å­˜åé‡æ–°æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ° **mvn** æ„å»ºæˆåŠŸï¼š

![](https://cbuc.top/1607311700829.png)

#### 2ï¼‰war åŒ…éƒ¨ç½²

å¦‚æœæˆ‘ä»¬çš„é¡¹ç›®æ˜¯æ‰“æˆ war åŒ…çš„å½¢å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å€ŸåŠ© **tomcat** å®¹å™¨æ¥è¿è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆä¾¿æ˜¯è¦å…ˆå®‰è£…ä¸€ä¸ª **tomcat**

#####  Tomcat å®‰è£…

æˆ‘ä»¬å°†äº‹å…ˆä¸‹è½½å¥½çš„ **Tomcat** å®‰è£…åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ `tar -xzf apache-tomcat-8.5.47.tar.gz` è§£å‹ï¼Œç„¶åè¿è¡Œ `bin`ç›®å½•ä¸‹çš„ `start.sh`å¯åŠ¨ **Tomcat** ï¼Œçœ‹åˆ°ä»¥ä¸‹ç»“æœåˆ™è¯´æ˜å¯åŠ¨æˆåŠŸï¼š

![](https://cbuc.top/1607312864719.png)

ä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦é…ç½®Tomcatç”¨æˆ·è§’è‰²æƒé™ï¼Œé»˜è®¤æƒ…å†µä¸‹Tomcatæ˜¯æ²¡æœ‰é…ç½®ç”¨æˆ·è§’è‰²æƒé™çš„ 

é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ `tomcat/conf/tomcat-users.xml` æ–‡ä»¶ï¼š

![](https://cbuc.top/1607317198007.png)

ï¼ˆå¤åˆ¶ï¼‰å†…å®¹å¦‚ä¸‹ï¼š

```xml
<role rolename="tomcat"/>
<role rolename="role1"/>
<role rolename="manager-script"/>
<role rolename="manager-gui"/>
<role rolename="manager-status"/>
<role rolename="admin-gui"/>
<role rolename="admin-script"/>
<user username="tomcat" password="tomcat" roles="manager-gui,manager-script,tomcat,admin-gui,admin-script"/>
```

ç„¶åä¿®æ”¹ `/tomcat/webapps/manager/META-INF/context.xml` æ–‡ä»¶ï¼Œå°†ä»¥ä¸‹å†…å®¹æ³¨é‡Šï¼š

![](https://cbuc.top/1607317386575.png)

ç„¶åè¿›å…¥**tomcat** é¡µé¢ï¼Œç‚¹å‡»è¿›å…¥ï¼š

![](https://cbuc.top/1607312972616.png)

è´¦å·å¯†ç éƒ½æ˜¯ **tomcat**

![](https://cbuc.top/1607317434159.png)

æˆåŠŸé¡µé¢å¦‚ä¸‹ï¼š

![](https://cbuc.top/1607317499447.png)

è¿™æ ·å­æˆ‘ä»¬å°±å®Œæˆäº† **tomcat** çš„å®‰è£…ï¼Œç„¶åæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œéƒ¨ç½²äº†

##### Tomcat éƒ¨ç½²

- åœ¨ **jenkins** ä¸­å®‰è£… `Deploy to container` æ’ä»¶
- æ·»åŠ  **Tomcat** å‡­è¯

![](https://cbuc.top/1607318181089.png)

- æ„å»ºé…ç½®

åœ¨é¡¹ç›®çš„ **configure** ä¸­é…ç½®

![](https://cbuc.top/1607318417492.png)

ç„¶åç‚¹å‡»æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

![](https://cbuc.top/1607318939149.png)

æ˜¾ç¤ºå·²ç»éƒ¨ç½²æˆåŠŸï¼Œç„¶åè®¿é—®é¡¹ç›®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° **war** åŒ…é¡¹ç›®éƒ¨ç½²æˆåŠŸï¼š

![](https://cbuc.top/1607318964360.png)

#### 3ï¼‰jar åŒ…éƒ¨ç½²

ä¸Šé¢è¯´å®Œäº† **war** åŒ…é¡¹ç›®æ˜¯å¦‚ä½•éƒ¨ç½²çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨é¡¹ç›®ç”¨åˆ°æ¯”è¾ƒå¤šçš„è¿˜æ˜¯ **SpringBoot** ï¼Œè¿™ä¸ªæ—¶å€™æ‰“å‡ºæ¥çš„æ˜¯ **jar** ç±»å‹ï¼Œä½†æ˜¯ **SpringBoot** é‡Œé¢å†…ç½®äº† **tomcat** å®¹å™¨ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±ä¸éœ€è¦å€ŸåŠ©å¤–éƒ¨ **tomcat** å®¹å™¨çš„ä½¿ç”¨äº†ã€‚

![](https://cbuc.top/1607430640484.png)

- é¦–å…ˆæˆ‘ä»¬åœ¨ **Jenkins** ä¸­ä¸‹è½½ **Maven** æ’ä»¶ï¼Œè¿™ä¸ªæ—¶å€™æ–°å»ºé¡¹ç›®çš„æ—¶å€™ä¼šæœ‰ä¸ª **Maven** é¡¹ç›®çš„é€‰é¡¹

![](https://cbuc.top/1607419258237.png)

ç„¶ååœ¨é¡¹ç›®çš„ **configure** ä¸­ä½œå¦‚ä¸‹é…ç½®ï¼š

![](https://cbuc.top/1607419613740.png)

>**Repository URL**ï¼šåº“åœ°å€
>**Credentials**ï¼šå‡­è¯
>**Branch Specifier (blank for â€˜anyâ€™)**ï¼šåˆ†æ”¯

![](https://cbuc.top/1607421585005.png)

> **Run only if build succeeds**ï¼šåœ¨æ„å»ºæˆåŠŸæ—¶æ‰§è¡Œåç»­æ­¥éª¤
> **Add post-build step**ï¼šæ·»åŠ æ„å»ºåçš„æ­¥éª¤
> **Send files or execute commands over SSH**ï¼šé€šè¿‡sshå‘é€æ–‡ä»¶æˆ–æ‰§è¡Œå‘½ä»¤

- å®‰è£… `Publish Over SSH` æ’ä»¶

å› ä¸ºæˆ‘ä»¬è¦éƒ¨ç½²çš„æœåŠ¡å™¨ä¸ **Jenkins** ä¸åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿™ä¸ªæ’ä»¶æ¥è¿œç¨‹éƒ¨ç½²

å®‰è£…å¥½æ’ä»¶åæˆ‘ä»¬éœ€è¦å…ˆé…ç½®è¿œç¨‹æœåŠ¡å™¨ï¼Œåœ¨ **Jenkins** æœåŠ¡å™¨ä¸Šè¾“å…¥ `ssh-copy-id è¿œç¨‹æœåŠ¡å™¨IP` å°†å…¬é’¥æ‹·è´åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨ **Jenkins** ç³»ç»Ÿé…ç½®ä¸­æ·»åŠ æœåŠ¡å™¨ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š

![](https://cbuc.top/1607429559421.png)

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°é¡¹ç›®çš„ **configure** ä¸­æ·»åŠ æˆ‘ä»¬åˆšåˆšé…ç½®çš„æœåŠ¡å™¨ä¿¡æ¯ï¼š

![](https://cbuc.top/1607419855828.png)

>**Name**ï¼šSSH Serversä¸­é…ç½®çš„æœåŠ¡å™¨
>**Source files**ï¼šæºæ–‡ä»¶
>**Remove prefix**ï¼šåˆ é™¤å‰ç¼€
>**Remote directory**ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ç›®å½•
>**Exec command**ï¼šæ‰§è¡Œçš„è„šæœ¬

å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ç‚¹å‡» **Build Now** äº†ï¼

![](https://cbuc.top/1607481783254.png)

#### 4ï¼‰æµæ°´çº¿é¡¹ç›®

**Jenkins** ä¸­è‡ªåŠ¨æ„å»ºé¡¹ç›®çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

- **è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®ï¼ˆFreeStyle Projectï¼‰**

- **Maven é¡¹ç›®ï¼ˆMaven Projectï¼‰**

- **æµæ°´çº¿é¡¹ç›®ï¼ˆPipeline Projectï¼‰**

æ¯ç§ç±»å‹çš„æ„å»ºå…¶å®éƒ½å¯ä»¥å®Œæˆä¸€æ ·çš„æ„å»ºè¿‡ç¨‹ä¸ç»“æœï¼Œåªæ˜¯åœ¨æ“ä½œæ–¹å¼ã€çµæ´»åº¦ç­‰æ–¹é¢æœ‰æ‰€åŒºåˆ«ï¼Œå…¶ä¸­æµæ°´çº¿ç±»å‹çµæ´»åº¦æ¯”è¾ƒé«˜ï¼Œå…¶ä»–ä¸¤ç§ç±»å‹æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­éƒ½å·²ç»å°è¯•è¿‡äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥ä»‹ç»å¦‚ä½•æ„å»ºæµæ°´çº¿é¡¹ç›®ã€‚

##### 1. æ¦‚å¿µ

**Pipeline** å°±æ˜¯ä¸€å¥—è¿è¡Œåœ¨ **Jenkins** ä¸Šçš„å·¥ä½œæµæ¡†æ¶ï¼Œå°†åŸæ¥ç‹¬ç«‹è¿è¡Œä¸å•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡è¿æ¥èµ·æ¥ï¼Œå®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„å¤æ‚æµç¨‹ç¼–æ’å’Œå¯è§†åŒ–å·¥ä½œ

##### 2. ä¼˜ç‚¹

- **ä»£ç **ï¼š**Pipeline** ä»¥ä»£ç çš„å½¢å¼å®ç°ï¼Œé€šå¸¸è¢«æ£€å…¥æºä»£ç æ§åˆ¶ï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿç¼–è¾‘ï¼Œå®¡æŸ¥å’Œè¿­ä»£å…¶ä¼ é€æµç¨‹ã€‚
- **æŒä¹…æ€§ï¼š** æ— è®ºæ˜¯è®¡åˆ’å†…çš„è¿˜æ˜¯è®¡åˆ’å¤–çš„æœåŠ¡å™¨é‡å¯ï¼Œ**Pipeline** éƒ½æ˜¯å¯æ¢å¤çš„
- **å¯åœæ­¢ï¼š** **Pipeline** å¯æ¥æ”¶äº¤äº’å¼è¾“å…¥ï¼Œä»¥ç¡®å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œ **Pipeline**
- **å¤šåŠŸèƒ½ï¼š** **Pipeline** æ”¯æŒç°å®ä¸–ç•Œä¸­å¤æ‚çš„æŒç»­äº¤ä»˜è¦æ±‚ï¼Œå®ƒæ”¯æŒ **fork/join** ã€å¾ªç¯æ‰§è¡Œã€å¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½
- **å¯æ‰©å±•ï¼š** **Pipeline** æ’ä»¶æ”¯æŒå…¶ **DSL** çš„è‡ªå®šä¹‰æ‰©å±•ï¼Œä»¥åŠä¸å…¶ä»–æ’ä»¶é›†æˆçš„å¤šä¸ªé€‰é¡¹

##### 3. åˆ›å»º

åˆ›å»º **Pipeline** é¡¹ç›®ä¹‹å‰æˆ‘ä»¬éœ€è¦å®‰è£… **Pipeline** æ’ä»¶ï¼š

![](https://cbuc.top/1607476590066.png)

ç„¶ååœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ä¾¿ä¼šå¤šäº† **Pipeline** ç±»å‹ï¼š

![](https://cbuc.top/1607476661542.png)

é€‰æ‹©å¥½é¡¹ç›®ç±»å‹ä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­çš„ **configure** è¿›è¡Œé…ç½®äº†ï¼š

- é¦–å…ˆè€æ ·å­é…ç½®å¥½ **git** åœ°å€ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ï¼Œè¿™é‡Œä¸å¤šä½œèµ˜è¯‰
- ç„¶åé…ç½® **Pipeline** è„šæœ¬

**Pipeline** é¡¹ç›®æ˜¯ç»Ÿä¸€é€šè¿‡ **Pipeline** è„šæœ¬æ¥ç®¡ç†ï¼Œè¿™æ ·ä¹Ÿæ›´å¥½çš„æé«˜çµæ´»æ€§

`Hello World` æ¨¡æ¿ï¼š

```java
pipeline {
    agent any
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
```

> **stagesï¼š** ä»£è¡¨æ•´ä¸ªæµæ°´çº¿çš„æ‰€æœ‰æ‰§è¡Œé˜¶æ®µï¼Œé€šå¸¸ **stages** åªæœ‰1ä¸ªï¼Œé‡Œé¢åŒ…å«å¤šä¸ª stage
>
> **stageï¼š** ä»£è¡¨ä¸€ä¸ªé˜¶æ®µå†…éœ€è¦æ‰§è¡Œçš„é€»è¾‘ï¼Œ**steps** é‡Œé¢æ˜¯ **shell** è„šæœ¬ï¼Œ**git** æ‹‰å–ä»£ç ï¼Œ**ssh** è¿œç¨‹å‘å¸ƒç­‰ä»»æ„å†…å®¹

`å£°æ˜å¼ Pipeline` æ¨¡æ¿ï¼š

```java
pipeline {
    agent any
    stages {
        stage('æ‹‰å–ä»£ç ') {
            steps {
                echo 'æ‹‰å–ä»£ç '
            }
        }
        stage('ç¼–è¯‘æ„å»º') {
            steps {
                echo 'ç¼–è¯‘æ„å»º'
            }
        }
        stage('é¡¹ç›®éƒ¨ç½²') {
            steps {
                echo 'é¡¹ç›®éƒ¨ç½²'
            }
        }
    }
}
```

ä½ ä¹Ÿå®Œå…¨ä¸ç”¨æ‹…å¿ƒä¸ä¼šä¹¦å†™ **Pipeline** è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡» `[Pipeline Syntax]` è·³è½¬åˆ° **Pipeline ä»£ç ç”Ÿæˆé¡µé¢**

![](https://cbuc.top/1607490697891.png)

![](https://cbuc.top/1607490860500.png)

ä¹¦å†™å¥½è„šæœ¬åç‚¹å‡»æ„å»ºï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼š

![](https://cbuc.top/1607575072554.png)

å¦‚æœæˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒï¼Œæ¯”å¦‚ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨é¡¹ç›®çš„ **configure** ä¸­è¿›è¡Œé…ç½®ï¼š

- é¦–å…ˆéœ€è¦å®‰è£… **Extended Choice Parameter** æ’ä»¶
- ç„¶ååœ¨é…ç½®ä¸­æ·»åŠ  **Extended Choice Parameter** å‚æ•°

![](https://cbuc.top/1607575370700.png)

å®Œæˆä»¥ä¸Šé…ç½®åï¼Œç‚¹å‡»ä¿å­˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åœ¨æ„å»ºçš„æ—¶å€™é€‰æ‹©éœ€è¦éƒ¨ç½²çš„æœåŠ¡å™¨äº†

![](https://cbuc.top/1607575461956.png)

ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä» **Pipeline** è„šæœ¬ä¸­è¯»å–æˆ‘ä»¬é€‰æ‹©çš„å‚æ•°ï¼Œè´´ä¸Šè¯¥é¡¹ç›®çš„æ„å»ºè„šæœ¬ï¼Œå¦‚ä¸‹ï¼š

![](https://cbuc.top/1607575755033.png)

```shell
node {
    //gitå‡­è¯ID
    def git_auth = "7fdb3fa3-74eb-4862-b36f-c03701f71250"
    //gitçš„urlåœ°å€
    def git_url = "git@192.168.100.131:cbuc_group/cbuc_web.git"
    //è·å–å½“å‰é€‰æ‹©çš„æœåŠ¡å™¨åç§°
    def selectedServers = "${publish_server}".split(",")

    stage('å¼€å§‹æ‹‰å–ä»£ç ') {
        checkout([$class: 'GitSCM', branches: [[name: '*/v3.0']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: git_auth, url: git_url]]])
    }
    stage('å¼€å§‹æ‰“åŒ…') {
        sh "mvn -Dmaven.test.skip=true clean package"
    }
    stage('å¼€å§‹è¿œç¨‹éƒ¨ç½²') {
        //éå†æ‰€æœ‰æœåŠ¡å™¨ï¼Œåˆ†åˆ«éƒ¨ç½²
        for(int j=0;j<selectedServers.length;j++){
            //è·å–å½“å‰éå†çš„æœåŠ¡å™¨åç§°
            def currentServerName = selectedServers[j]
            //ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç›®å½•
            def pro_address = "/home/pro/java"
            //å¼€å‘ç¯å¢ƒéƒ¨ç½²ç›®å½•
            def dev_address = "/home/dev/java"

            //æ ¹æ®ä¸åŒçš„profileæ¥éƒ¨ç½²æœåŠ¡å™¨
            if(currentServerName=="pro"){
                sshPublisher(publishers: [sshPublisherDesc(configName: 'pro_server', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'sh build.sh', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: pro_address, remoteDirectorySDF: false, removePrefix: 'target', sourceFiles: 'target/cbuc_web-0.0.1-SNAPSHOT.jar')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            }else if(currentServerName=="dev"){
                sshPublisher(publishers: [sshPublisherDesc(configName: 'dev_server', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: "sh build.sh", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: dev_address, remoteDirectorySDF: false, removePrefix: 'target', sourceFiles: 'target/cbuc_web-0.0.1-SNAPSHOT.jar')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            }
        }
    }
}
```

è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å¦‚æœéƒ¨ç½² **Jenkins** çš„æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šä¸¢å¤± **Pipeline** è„šæœ¬æ–‡ä»¶ï¼Œé‡æ–°ä¹¦å†™æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†è„šæœ¬æ–‡ä»¶æ”¾åˆ°æˆ‘ä»¬çš„é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ **configure** ä¸­é…ç½® **Pipeline** è„šæœ¬æ–‡ä»¶çš„ä½ç½®ï¼š

![](https://cbuc.top/1607576171799.png)

![](https://cbuc.top/1607576845509.png)

ç„¶åæˆ‘ä»¬ç‚¹å‡»æ„å»ºï¼Œå¯ä»¥çœ‹åˆ°ç»“æœä¹Ÿæ˜¯æˆåŠŸçš„ï¼š

![](https://cbuc.top/1607576884664.png)

#### 5ï¼‰æ„å»ºè§¦å‘å™¨

ä¸Šé¢æˆ‘ä»¬è®²å®Œäº†å‡ ç§é¡¹ç›®çš„æ„å»ºæ–¹å¼ï¼Œå…¶ä¸­éƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨ç‚¹å‡»æ„å»ºè¿›è¡Œæ„å»ºçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è§¦å‘å™¨æ¥æ„å»º

![](https://cbuc.top/1607577021134.png)

å¸¸ç”¨çš„æœ‰ï¼š

##### 1. Build After Other Projects Are Built

![](https://cbuc.top/1607577810259.png)

å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘ã€‚åœ¨é€‰é¡¹ä¸­å¡«å†™æˆ‘ä»¬å…³æ³¨çš„é¡¹ç›®ï¼Œå…¶ä¸­ä¹Ÿæ”¯æŒ3ä¸ªé€‰æ‹©ä»¥ä¾›é€‰æ‹©ï¼š

> **Trigger only if build is stableï¼š** ä»…åœ¨é¡¹ç›®ç¨³å®šæ„å»ºæ—¶æ‰§è¡Œ
>
> **Trigger even if the build is unstableï¼š** å³ä½¿é¡¹ç›®æ„å»ºä¸ç¨³å®šä¹Ÿæ‰§è¡Œ
>
> **Trigger even if the build failsï¼š** å³ä½¿é¡¹ç›®æ„å»ºå¤±è´¥ä¹Ÿæ‰§è¡Œ

##### 2. Build Periodically 

![](https://cbuc.top/1607578099791.png)

å®šæ—¶æ„å»ºã€‚è¯­æ³•ç±»å‹å¦‚ **cron** è¡¨è¾¾å¼ï¼Œå®šæ—¶å­—ç¬¦ä¸²ä»å·¦å¾€å³åˆ†åˆ«ä¸ºï¼š **åˆ† æ—¶ æ—¥ æœˆ å‘¨**

##### 3. Poll SCM

 è½®è¯¢ SCMã€‚æŒ‡å®šæ—¶é—´æ‰«ææœ¬åœ°ä»£ç ä»“åº“çš„ä»£ç æ˜¯å¦æœ‰å˜æ›´ï¼Œå¦‚æœä»£ç æœ‰å˜æ›´å°±è§¦å‘é¡¹ç›®æ„å»ºã€‚

![](https://cbuc.top/1607578220076.png)

##### 4. Trigger builds remotely

![](https://cbuc.top/1607578345486.png)

è¿œç¨‹è§¦å‘æ„å»ºã€‚é€šè¿‡ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„å¯†é’¥ï¼Œç„¶åè®¿é—®æ„å»ºåœ°å€ï¼š`http://192.168.100.131:8888/job/test01/build?token=123123`

##### 5. è‡ªåŠ¨è§¦å‘æ„å»º

åˆšæ‰æˆ‘ä»¬çœ‹åˆ°åœ¨**Jenkins**çš„å†…ç½®æ„å»ºè§¦å‘å™¨ä¸­ï¼Œ**è½®è¯¢SCM**å¯ä»¥å®ç°**Gitlab**ä»£ç æ›´æ–°ï¼Œé¡¹ç›®è‡ªåŠ¨æ„å»ºï¼Œä½†æ˜¯è¯¥æ–¹æ¡ˆçš„æ€§èƒ½ä¸ä½³ã€‚é‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿ æœ‰çš„ã€‚å°±æ˜¯åˆ©ç”¨**Gitlab**çš„**webhook**å®ç°ä»£ç **push**åˆ°ä»“åº“ï¼Œç«‹å³è§¦å‘é¡¹ç›®è‡ªåŠ¨æ„å»ºã€‚

![](https://cbuc.top/1607587885407.png)

å®Œæˆè‡ªåŠ¨è§¦å‘æ„å»ºæˆ‘ä»¬éœ€è¦åœ¨ **Jenkins** å®‰è£…æ’ä»¶ï¼š`GitLab Hook` å’Œ `GitLab`

![](https://cbuc.top/1607590193712.png)

ç„¶åæˆ‘ä»¬åœ¨ **Build Trigger** ä¸­å°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªé€‰é¡¹ï¼š

![](https://cbuc.top/1607590434659.png)

å¤åˆ¶è¿™ä¸² **WebHook** åœ°å€ï¼Œè·Ÿç€åˆ° **GitLab** é¡µé¢è¿›è¡Œè®¾ç½®ï¼š

è·¯å¾„æ­¥éª¤ï¼š`Admin Area -> Settings -> Network`

![](https://cbuc.top/1607591771899.png)

ç„¶åæˆ‘ä»¬åœ¨å¯¹åº”çš„é¡¹ç›®ä¸­è¿›è¡Œè®¾ç½®ï¼š

![](https://cbuc.top/1607592410163.png)

æœ€åå†å›åˆ° **Jenkins** é¡µé¢ä¸­åšä»¥ä¸‹é…ç½®ï¼š`Manage Jenkins->Configure System`

![](https://cbuc.top/1607593556818.png)

åšå®Œä»¥ä¸Šé…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä»£ç è¿›è¡Œè‡ªåŠ¨è§¦å‘æ„å»ºäº†ï¼



**END**

è¿™ç¯‡æ–‡ç« è¾ƒé•¿ï¼Œéƒ½æ˜¯æ»¡æ»¡çš„å¹²è´§ï¼Œä»å®‰è£…åˆ°ä½¿ç”¨ï¼Œä¸€æ­¥æ­¥å¸¦ä½ å…¥ `è¿ç»´` çš„å‘ï¼Œå­¦å®Œè¿™ç¯‡å¿«ç»™ä½ çš„é¡¹ç›®ç”¨ä¸Šå§ï¼è·¯æ¼«æ¼«ï¼Œå°èœä¸ä½ ä¸€åŒæ±‚ç´¢ï¼

![çœ‹å®Œä¸èµï¼Œéƒ½æ˜¯åè›‹](https://imgconvert.csdnimg.cn/aHR0cHM6Ly93d3cuNTJkb3V0dS5jbi9zdGF0aWMvdGVtcC9waWMvOWJkNjhkMTUwZjA3ODdjNTYwYTQzOWRhMzU5YTU4MGEucG5n?x-oss-process=image/format,png#pic_center)
> ä»Šå¤©çš„ä½ å¤šåŠªåŠ›ä¸€ç‚¹ï¼Œæ˜å¤©çš„ä½ å°±èƒ½å°‘è¯´ä¸€å¥æ±‚äººçš„è¯ï¼
>
> *æˆ‘æ˜¯å°èœï¼Œä¸€ä¸ªå’Œä½ ä¸€èµ·å­¦ä¹ çš„ç”·äººã€‚* `ğŸ’‹`
>
>
> å¾®ä¿¡å…¬ä¼—å·å·²å¼€å¯ï¼Œ**å°èœè‰¯è®°**ï¼Œæ²¡å…³æ³¨çš„åŒå­¦ä»¬è®°å¾—å…³æ³¨å“¦ï¼