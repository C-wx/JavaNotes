大家好，我是小菜，一个渴望在互联网行业做到蔡不菜的小菜。可柔可刚，点赞则柔，白嫖则刚！
**死鬼~看完记得给我来个三连哦！**

![](https://user-gold-cdn.xitu.io/2020/4/11/17169c46045528af?w=240&h=224&f=jpeg&s=7529)

>本文主要介绍 `java性能分析之 JIT编译器`
>**本文较长，分为上下篇（可收藏，勿吃尘）**
>如有需要，可以参考
>如有帮助，不忘 **点赞** ❥

作为Java开发人员，也许在工作中最经常用到的只是 **CRUD**，**解决性能问题** 也许不经常接触到，但是也是需要了解一二的！这篇文章小菜带你一起探究 `Java中的JIT编译器`

![文章大纲](https://pics.images.ac.cn/image/5eb7bdf4c511d.html)

### 前情概览

即时 `JIT（JUst-In-Time）`编译器是Java虚拟机的核心，对 ***JVM性能*** 影响最大的也就是编译器。

`CPU` 是计算机的核心，到时只能执行相对少而且特定的指令，例如**汇编码**和**二进制码** ，因此 CPU 所执行的程序都必须翻译成这种指令。

![语言结构](https://pics.images.ac.cn/image/5eb7c355a63a0.html)

- 编译型语言：会编译成**二进制形式** 交付，先写程序，然后用编译器静态生成二进制文件。
- 解释型语言：只要机器上有合适的解释器，相同的程序代码可以在任何 CPU 上执行，执行程序时，解释器会将相应代码转换为二进制代码。

*Java试图走一条中间路线，Java应用会被编译——但不是编译成特定 CPU 所专用的二进制编码，而是被编译成一种理想化的汇编语言。然后该汇编语言（Java字节码）可以用Java运行*。因此 Java 是一门 **平台独立性**的**解释型语言**。

#### 热点编译

JVM 执行代码时，只会编译经常被调用的。因此被编译的代码需要具备以下特性：

- 代码是经常被调用的代码
- 运行很多次迭代的循环

而这些关键代码段被称为**应用的热点**，代码执行得越多就被认为是**越热**的。因此编译器`会先解释执行代码，然后找出哪个方法被调用的足够频繁，才进行编译`。这也是为了***优化***：JVM 执行特定方法或者循环的次数越多，它就会越了解这段代码，这样可以使 JVM 在编译代码时进行大量优化。

#### 小结

- Java的设计结合了脚本语言的平台独立性和编译型语言的本地性能
- Java文件被编译成中间语言（Java字节码），然后在运行时被JVM进一步编译成汇编语言
- 字节码编译成汇编语言的过程中有大量的优化，极大地改善了性能

### 调优入门

####  一、两种 “口味”

- *Client 编译器*
- *Server编译器*

命令行上选择编译器类型则采用以上两个名字：`-client`和`-server`。通常这两个编译器也称为 **c1 编译器（client编译器）** 和 **c2  编译器（server编译器）**

***分层编译器***：分层编译意味着必须使用 server 编译器

关闭分层编译： `java -client -XX:+TieredCompilation other_args`

*两者的主要区别：*

在于编译代码的时机不同。client编译器开启编译比server编译器要早。这意味着；在代码执行的开始阶段，client编译器比server编译器要快，因为他编译代码相比server编译器而言要多。

*问题来了*：

JVM 能不能在启动的时候用 client 编译器，然后随着代码变热使用 server 编译器？

*方案：*

**分层编译**：代码先由 client 编译器编译，随着代码变热， 由 server 编译器重新编译。在 Java 1.8 中，分层编译是默认开启的。

#### 二、优化启动

当快速启动时间是首要目标时了，最常使用 client 编译器。

当整体性能比启动性能更重要时，更适合使用 server 编译器。

*小结:*

1. 如果应用的启动时间是首要的性能考量